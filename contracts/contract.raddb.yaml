dataContractSpecification: 1.2.1
id: my-data-contract-id
info:
  title: My Data Contract
  version: 0.0.1

description:
  purpose: RADIUS Accounting Data
  description: |
    This contract defines the schema for RADIUS accounting data, which is used to track user sessions
    in a network environment. The data includes information about session start and stop times, data usage,
    and other relevant metrics.
  
servers:
  mysql:
    server: mysql
    type: mysql
    host: localhost
    port: 3306
    username: root
    password: 123
    database: raddb
    schema: public

models:
  raddb:
    description: RADIUS Accounting Data Model
    type: table
    fields:
      radacctid:
        type: integer
        physicalType: bigint(20)
        required: true
        unique: true
        primaryKey: true
        description: Unique identifier for accounting record.
        classification: public

      acctsessionid:
        type: string
        physicalType: varchar(64)
        required: true
        description: Session ID assigned by RADIUS client.
        classification: public

      acctuniqueid:
        type: string
        physicalType: varchar(32)
        required: true
        unique: true
        description: Unique accounting session ID across all NAS devices.
        classification: public

      realm:
        type: string
        physicalType: varchar(64)
        description: Network realm or domain of the user.
        classification: public

      nasportid:
        type: string
        physicalType: varchar(15)
        description: NAS port identifier.
        classification: public
        quality:
          - type: text
            description: Must follow format "Uniq-Sess-IDXX".

      nasporttype:
        type: string
        physicalType: varchar(32)
        description: Type of NAS port (e.g., Virtual, ISDN).
        classification: public
        quality:
          - type: library
            metric: invalidValues
            arguments:
              validValues: [ 'Virtual', 'ISDN' ]
            description: Ensure nasporttype uses valid port types.
            mustBeLessThan: 1

      acctstarttime:
        type: timestamp
        physicalType: datetime
        description: Time when session started.
        classification: public

      acctupdatetime:
        type: timestamp
        physicalType: datetime
        description: Last update timestamp for ongoing sessions.
        classification: public

      acctstoptime:
        type: timestamp
        physicalType: datetime
        description: Time when session stopped.
        classification: public
        quality:
          - type: text
            description: acctstoptime must be later than acctstarttime.

      acctinterval:
        type: integer
        physicalType: int(11)
        description: Interval between interim updates.
        classification: public

      acctsessiontime:
        type: integer
        physicalType: int(10) unsigned
        description: Total session duration in seconds.
        classification: public
        quality:
          - type: sql
            description: 95% of acctsessiontime should be less than 30000 seconds.
            query: SELECT quantile(acctsessiontime, 0.95) AS session_time_90th_percentile FROM radacct
            mustBeLessThan: 30000

      acctauthentic:
        type: string
        physicalType: varchar(32)
        description: Authentication type used (e.g., RADIUS, Local).
        classification: public

      connectinfo_start:
        type: string
        physicalType: varchar(50)
        description: Connection information when session started.
        classification: public

      connectinfo_stop:
        type: string
        physicalType: varchar(50)
        description: Connection information when session stopped.
        classification: public

      acctinputoctets:
        type: integer
        physicalType: bigint(20)
        description: Total number of input octets received during session.
        classification: public

      acctoutputoctets:
        type: integer
        physicalType: bigint(20)
        description: Total number of output octets sent during session.
        classification: public

      calledstationid:
        type: string
        physicalType: varchar(50)
        description: Identifier of the called station (e.g., access point MAC).
        classification: public
        quality:
          - type: library
            metric: nullValues
            description: calledstationid should not be null.
            mustBeLessThan: 10
            unit: percent

      callingstationid:
        type: string
        physicalType: varchar(50)
        description: Identifier of the calling station (e.g., client MAC).
        classification: restricted
        quality:
          - type: library
            metric: nullValues
            description: callingstationid should not be null.
            mustBeLessThan: 10
            unit: percent

      acctterminatecause:
        type: string
        physicalType: varchar(32)
        description: Reason why session was terminated (e.g., User-Request, Lost-Carrier).
        classification: public
        quality:
          - type: library
            metric: invalidValues
            arguments:
              validValues: [ 'User-Request', 'Admin-Reset', 'Host-Request', 'NAS-Error', 'Port-Error', 'Service-Unvaliable' ]
            description: Ensure acctterminatecause uses valid RADIUS termination codes.
            mustBeLessThan: 1

      servicetype:
        type: string
        physicalType: varchar(32)
        description: Type of service provided to the user.
        classification: public

      framedprotocol:
        type: string
        physicalType: varchar(32)
        description: Framed protocol (e.g., PPP, SLIP).
        classification: public

      framedipv6address:
        type: string
        physicalType: varchar(45)
        description: IPv6 address assigned to the session.
        classification: public

      framedipv6prefix:
        type: string
        physicalType: varchar(45)
        description: IPv6 prefix for the session.
        classification: public

      framedinterfaceid:
        type: string
        physicalType: varchar(44)
        description: Interface ID associated with IPv6.
        classification: public

      delegatedipv6prefix:
        type: string
        physicalType: varchar(45)
        description: Delegated IPv6 prefix for downstream clients.
        classification: public

      created_at:
        type: timestamp
        physicalType: timestamp
        required: true
        description: Record creation timestamp.
        classification: public

servicelevels:
  freshness:
      description: The age of the youngest row in a table.
      threshold: 25h
      timestampField: radacct.created_at
